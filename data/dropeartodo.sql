USE [GD1C2022]
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

/* Comienzo Drop de Tablas para limpiar por si la DB ya tenia algunas tablas sucias antes */
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_Incidente]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[BI_Incidente]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_Parada]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[BI_Parada]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_Telemetria]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[BI_Telemetria]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_Circuito]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[BI_Circuito]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_Escuderia]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[BI_Escuderia]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_Auto]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[BI_Auto]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_Piloto]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[BI_Piloto]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_Tipo_Sector]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[BI_Tipo_Sector]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_Tipo_Neumatico]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[BI_Tipo_Neumatico]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_Tipo_Incidente]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[BI_Tipo_Incidente]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_Tiempo]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[BI_Tiempo]
GO

/***************/
/* DROP VISTAS */
/***************/

IF EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_MEJORES_TIEMPOS_ESCUDERIAS]') and type in (N'V'))
DROP VIEW [MARCO_AND_FRIENDS].[BI_MEJORES_TIEMPOS_ESCUDERIAS];
GO

IF EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_TOP_3_CIRCUITOS_TIEMPO_BOXES]') and type in (N'V'))
DROP VIEW [MARCO_AND_FRIENDS].[BI_TOP_3_CIRCUITOS_TIEMPO_BOXES];
GO

IF EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_TOP_3_CIRCUITOS_PELIGROSOS]') and type in (N'V'))
DROP VIEW [MARCO_AND_FRIENDS].[BI_TOP_3_CIRCUITOS_PELIGROSOS];
GO

IF EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_MAX_VELOCIDAD_POR_AUTO_POR_TIPO_SECTOR_POR_CIRCUITO]') and type in (N'V'))
DROP VIEW [MARCO_AND_FRIENDS].[BI_MAX_VELOCIDAD_POR_AUTO_POR_TIPO_SECTOR_POR_CIRCUITO];
GO

IF EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_PROMEDIO_INCIDENTES_ESCUDERIA_POR_ANIO_POR_SECTOR]') and type in (N'V'))
DROP VIEW [MARCO_AND_FRIENDS].[BI_PROMEDIO_INCIDENTES_ESCUDERIA_POR_ANIO_POR_SECTOR];
GO

IF EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_CANTIDAD_PARADAS_POR_ESCUDERIA_POR_CIRCUITO]') and type in (N'V'))
DROP VIEW [MARCO_AND_FRIENDS].[BI_CANTIDAD_PARADAS_POR_ESCUDERIA_POR_CIRCUITO];
GO

IF EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_TIEMPO_PROMEDIO_PARADAS_POR_CUATRIMESTRE]') and type in (N'V'))
DROP VIEW [MARCO_AND_FRIENDS].[BI_TIEMPO_PROMEDIO_PARADAS_POR_CUATRIMESTRE];
GO

IF EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_CIRCUITOS_CON_MAYOR_CONSUMO_DE_COMBUSTIBLE_PROMEDIO]') and type in (N'V'))
DROP VIEW [MARCO_AND_FRIENDS].[BI_CIRCUITOS_CON_MAYOR_CONSUMO_DE_COMBUSTIBLE_PROMEDIO];
GO

IF EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[BI_DESGASTE_PROMEDIO_AUTO_POR_VUELTA_POR_CIRCUITO]') and type in (N'V'))
DROP VIEW [MARCO_AND_FRIENDS].[BI_DESGASTE_PROMEDIO_AUTO_POR_VUELTA_POR_CIRCUITO];
GO

/******************/
/* DROP FUNCIONES */
/******************/

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[CUATRIMESTRE]') AND type IN (N'FN', N'IF', N'TF'))
DROP FUNCTION [MARCO_AND_FRIENDS].[CUATRIMESTRE]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[GET_PK_TIEMPO]') AND type IN (N'FN', N'IF', N'TF'))
DROP FUNCTION [MARCO_AND_FRIENDS].[GET_PK_TIEMPO]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[GET_PK_TIPO_SECTOR]') AND type IN (N'FN', N'IF', N'TF'))
DROP FUNCTION [MARCO_AND_FRIENDS].[GET_PK_TIPO_SECTOR]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[GET_PK_TIPO_NEUMATICO]') AND type IN (N'FN', N'IF', N'TF'))
DROP FUNCTION [MARCO_AND_FRIENDS].[GET_PK_TIPO_NEUMATICO]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[GET_PK_TIPO_INCIDENTE]') AND type IN (N'FN', N'IF', N'TF'))
DROP FUNCTION [MARCO_AND_FRIENDS].[GET_PK_TIPO_INCIDENTE]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[CONSUMO_CIRCUITO_AUTO]') AND type IN (N'FN', N'IF', N'TF'))
DROP FUNCTION [MARCO_AND_FRIENDS].[CONSUMO_CIRCUITO_AUTO]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[DESGASTE_MOTOR]') AND type IN (N'FN', N'IF', N'TF'))
DROP FUNCTION [MARCO_AND_FRIENDS].[DESGASTE_MOTOR]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[DESGASTE_NEUMATICO1]') AND type IN (N'FN', N'IF', N'TF'))
DROP FUNCTION [MARCO_AND_FRIENDS].[DESGASTE_NEUMATICO1]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[DESGASTE_NEUMATICO2]') AND type IN (N'FN', N'IF', N'TF'))
DROP FUNCTION [MARCO_AND_FRIENDS].[DESGASTE_NEUMATICO2]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[DESGASTE_NEUMATICO3]') AND type IN (N'FN', N'IF', N'TF'))
DROP FUNCTION [MARCO_AND_FRIENDS].[DESGASTE_NEUMATICO3]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[DESGASTE_NEUMATICO4]') AND type IN (N'FN', N'IF', N'TF'))
DROP FUNCTION [MARCO_AND_FRIENDS].[DESGASTE_NEUMATICO4]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[DESGASTE_FRENO1]') AND type IN (N'FN', N'IF', N'TF'))
DROP FUNCTION [MARCO_AND_FRIENDS].[DESGASTE_FRENO1]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[DESGASTE_FRENO2]') AND type IN (N'FN', N'IF', N'TF'))
DROP FUNCTION [MARCO_AND_FRIENDS].[DESGASTE_FRENO2]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[DESGASTE_FRENO3]') AND type IN (N'FN', N'IF', N'TF'))
DROP FUNCTION [MARCO_AND_FRIENDS].[DESGASTE_FRENO3]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[DESGASTE_FRENO4]') AND type IN (N'FN', N'IF', N'TF'))
DROP FUNCTION [MARCO_AND_FRIENDS].[DESGASTE_FRENO4]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[DESGASTE_CAJA]') AND type IN (N'FN', N'IF', N'TF'))
DROP FUNCTION [MARCO_AND_FRIENDS].[DESGASTE_CAJA]
GO

/* Drops Transaccional */

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[Telemetria_Auto]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[Telemetria_Auto]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[Parada_Box]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[Parada_Box]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[Incidente_Auto]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[Incidente_Auto]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[Incidente]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[Incidente]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[Sector]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[Sector]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[Carrera]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[Carrera]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[Circuito]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[Circuito]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[Piloto]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[Piloto]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[Auto]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[Auto]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[Escuderia]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[Escuderia]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[Telemetria_Neumatico]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[Telemetria_Neumatico]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[Cambio_Neumatico]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[Cambio_Neumatico]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[Neumatico]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[Neumatico]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[Telemetria_Motor]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[Telemetria_Motor]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[Motor]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[Motor]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[Telemetria_Freno]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[Telemetria_Freno]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[Freno]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[Freno]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[Telemetria_Caja]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[Telemetria_Caja]
GO

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[Caja]') AND type in (N'U'))
DROP TABLE [MARCO_AND_FRIENDS].[Caja]
GO

IF EXISTS (SELECT * FROM sys.objects WHERE type = 'P' AND object_id = OBJECT_ID(N'[MARCO_AND_FRIENDS].[MIGRAR_TABLA_MAESTRA]'))
DROP PROCEDURE [MARCO_AND_FRIENDS].[MIGRAR_TABLA_MAESTRA]
GO

IF EXISTS (SELECT * FROM sys.schemas WHERE name = 'MARCO_AND_FRIENDS')
DROP SCHEMA [MARCO_AND_FRIENDS]
GO